StmtText                                                                                                                                                                                                                                                                                       StmtId      NodeId      Parent      PhysicalOp                     LogicalOp                      Argument                                                                                                                                                                                     DefinedValues                                                                                                               EstimateRows   EstimateIO     EstimateCPU    AvgRowSize  TotalSubtreeCost OutputList                                                                                                                           Warnings Type                                                             Parallel EstimateExecutions
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------- ----------- ----------- ------------------------------ ------------------------------ -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------------------------------------------------------------------------------------------------- -------------- -------------- -------------- ----------- ---------------- ------------------------------------------------------------------------------------------------------------------------------------ -------- ---------------------------------------------------------------- -------- ------------------

select
	sum(l_extendedprice) / 7.0 as avg_yearly
from
	lineitem,
	part
where
	p_partkey = l_partkey
	and p_brand = 'Brand#13'
	and p_container = 'WRAP BAG'
	and l_quantity < (
		select
			0.2 * avg(l_quantity)
		from
			lineitem
		where
			l_partkey = p_partkey
	);              1           1           0 NULL                           NULL                           1                                                                                                                                                                                            NULL                                                                                                                                   1.0           NULL           NULL        NULL        831.20953 NULL                                                                                                                                 NULL     SELECT                                                                  0               NULL
  |--Parallelism(Gather Streams)                                                                                                                                                                                                                                                                         1           2           1 Parallelism                    Gather Streams                 NULL                                                                                                                                                                                         NULL                                                                                                                                   1.0            0.0     0.02850277          24        831.20953 [Expr1009]                                                                                                                           NULL     PLAN_ROW                                                               -1                1.0
       |--Compute Scalar(DEFINE:([Expr1009]=[Expr1008]/(7.0)))                                                                                                                                                                                                                                           1           3           2 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1009]=[Expr1008]/(7.0))                                                                                                                                                         [Expr1009]=[Expr1008]/(7.0)                                                                                                            1.0            0.0         2.5E-9          24        831.18103 [Expr1009]                                                                                                                           NULL     PLAN_ROW                                                               -1                1.0
            |--Compute Scalar(DEFINE:([Expr1008]=CASE WHEN [Expr1049]=(0) THEN NULL ELSE [Expr1050] END))                                                                                                                                                                                                1           4           3 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1008]=CASE WHEN [Expr1049]=(0) THEN NULL ELSE [Expr1050] END)                                                                                                                   [Expr1008]=CASE WHEN [Expr1049]=(0) THEN NULL ELSE [Expr1050] END                                                                      1.0            0.0            0.0          24        831.18103 [Expr1008]                                                                                                                           NULL     PLAN_ROW                                                               -1                1.0
                 |--Hash Match(Aggregate, HASH:() DEFINE:([Expr1049]=COUNT_BIG([TPCH].[dbo].[lineitem].[L_ExtendedPrice]), [Expr1050]=SUM([TPCH].[dbo].[lineitem].[L_ExtendedPrice])))                                                                                                                   1           5           4 Hash Match                     Aggregate                      HASH:()                                                                                                                                                                                      [Expr1049]=COUNT_BIG([TPCH].[dbo].[lineitem].[L_ExtendedPrice]), [Expr1050]=SUM([TPCH].[dbo].[lineitem].[L_ExtendedPrice])             1.0            0.0   4.7545093E-3          24        831.18103 [Expr1049], [Expr1050]                                                                                                               NULL     PLAN_ROW                                                               -1                1.0
                      |--Nested Loops(Inner Join)                                                                                                                                                                                                                                                        1           7           5 Nested Loops                   Inner Join                     NULL                                                                                                                                                                                         NULL                                                                                                                          5.9986052E+7            0.0      1.6904422          16        831.16125 [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                                                                                            NULL     PLAN_ROW                                                               -1                1.0
                           |--Table Spool                                                                                                                                                                                                                                                                1           8           7 Table Spool                    Lazy Spool                     NULL                                                                                                                                                                                         NULL                                                                                                                             6399.1685            0.0            0.0          24        829.40491 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                 NULL     PLAN_ROW                                                               -1                1.0
                           |    |--Segment                                                                                                                                                                                                                                                               1           9           8 Segment                        Segment                        [TPCH].[dbo].[lineitem].[L_PartKey]                                                                                                                                                          NULL                                                                                                                             462514.81            0.0     0.21953794          24        829.18542 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice], [Segment1046]  NULL     PLAN_ROW                                                               -1                1.0
                           |         |--Sort(ORDER BY:([TPCH].[dbo].[lineitem].[L_PartKey] ASC))                                                                                                                                                                                                         1          10           9 Sort                           Sort                           ORDER BY:([TPCH].[dbo].[lineitem].[L_PartKey] ASC)                                                                                                                                           NULL                                                                                                                             462514.81   2.8153153E-3      9.9880152          24        828.96588 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                 NULL     PLAN_ROW                                                               -1                1.0
                           |              |--Parallelism(Repartition Streams, Hash Partitioning, PARTITION COLUMNS:([TPCH].[dbo].[lineitem].[L_PartKey]))                                                                                                                                                1          11          10 Parallelism                    Repartition Streams            PARTITION COLUMNS:([TPCH].[dbo].[lineitem].[L_PartKey])                                                                                                                                      NULL                                                                                                                             462514.81            0.0     0.52099156          24        818.97504 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                 NULL     PLAN_ROW                                                               -1                1.0
                           |                   |--Hash Match(Inner Join, HASH:([TPCH].[dbo].[part].[P_PartKey])=([TPCH].[dbo].[lineitem].[L_PartKey])DEFINE:([Opt_Bitmap1040]))                                                                                                                          1          12          11 Hash Match                     Inner Join                     HASH:([TPCH].[dbo].[part].[P_PartKey])=([TPCH].[dbo].[lineitem].[L_PartKey])                                                                                                                 [Opt_Bitmap1040]                                                                                                                 462514.81            0.0     0.10823403          24        818.45367 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                 NULL     PLAN_ROW                                                               -1                1.0
                           |                        |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[part].[PK__part__418EE012D7A9C198]),  WHERE:([TPCH].[dbo].[part].[P_Brand]='Brand#13' AND [TPCH].[dbo].[part].[P_Container]='WRAP BAG'))                                                               1          13          12 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[part].[PK__part__418EE012D7A9C198]),  WHERE:([TPCH].[dbo].[part].[P_Brand]='Brand#13' AND [TPCH].[dbo].[part].[P_Container]='WRAP BAG')                                [TPCH].[dbo].[part].[P_PartKey]                                                                                                   9933.751      25.372755     0.55003923          32        25.922794 [TPCH].[dbo].[part].[P_PartKey]                                                                                                      NULL     PLAN_ROW                                                               -1                1.0
                           |                        |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[lineitem].[PK__lineitem__2B16504E85092D9C]),  WHERE:([TPCH].[dbo].[lineitem].[L_PartKey] IS NOT NULL AND PROBE([Opt_Bitmap1040],[TPCH].[dbo].[lineitem].[L_PartKey])))                                 1          15          12 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[lineitem].[PK__lineitem__2B16504E85092D9C]),  WHERE:([TPCH].[dbo].[lineitem].[L_PartKey] IS NOT NULL AND PROBE([Opt_Bitmap1040],[TPCH].[dbo].[lineitem].[L_PartKey]))  [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]              599860.5       768.3031      16.481207          24         784.7843 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                 NULL     PLAN_ROW                                                               -1                1.0
                           |--Nested Loops(Inner Join, WHERE:([TPCH].[dbo].[lineitem].[L_Quantity]<(0.2)*CONVERT_IMPLICIT(numeric(10,0),[Expr1006],0)))                                                                                                                                                  1          16           7 Nested Loops                   Inner Join                     WHERE:([TPCH].[dbo].[lineitem].[L_Quantity]<(0.2)*CONVERT_IMPLICIT(numeric(10,0),[Expr1006],0))                                                                                              NULL                                                                                                                             72.277328            0.0   2.1953795E-2          24       0.04390759 [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                                                                                            NULL     PLAN_ROW                                                               -1          6400.1685
                                |--Compute Scalar(DEFINE:([Expr1006]=CASE WHEN [Expr1047]=(0) THEN NULL ELSE [Expr1048]/CONVERT_IMPLICIT(int,[Expr1047],0) END))                                                                                                                                         1          17          16 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1006]=CASE WHEN [Expr1047]=(0) THEN NULL ELSE [Expr1048]/CONVERT_IMPLICIT(int,[Expr1047],0) END)                                                                                [Expr1006]=CASE WHEN [Expr1047]=(0) THEN NULL ELSE [Expr1048]/CONVERT_IMPLICIT(int,[Expr1047],0) END                                   1.0            0.0   2.1953795E-3          24     2.4149174E-2 [Expr1006]                                                                                                                           NULL     PLAN_ROW                                                               -1          6400.1685
                                |    |--Stream Aggregate(DEFINE:([Expr1047]=COUNT_BIG([TPCH].[dbo].[lineitem].[L_Quantity]), [Expr1048]=SUM([TPCH].[dbo].[lineitem].[L_Quantity])))                                                                                                                      1          18          17 Stream Aggregate               Aggregate                      NULL                                                                                                                                                                                         [Expr1047]=COUNT_BIG([TPCH].[dbo].[lineitem].[L_Quantity]), [Expr1048]=SUM([TPCH].[dbo].[lineitem].[L_Quantity])                       1.0            0.0   2.1953795E-2          24     2.1953795E-2 [Expr1047], [Expr1048]                                                                                                               NULL     PLAN_ROW                                                               -1          6400.1685
                                |         |--Table Spool                                                                                                                                                                                                                                                 1          19          18 Table Spool                    Lazy Spool                     NULL                                                                                                                                                                                         NULL                                                                                                                             72.277328            0.0            0.0          24              0.0 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                 NULL     PLAN_ROW                                                               -1          6400.1685
                                |--Table Spool                                                                                                                                                                                                                                                           1          20          16 Table Spool                    Lazy Spool                     NULL                                                                                                                                                                                         NULL                                                                                                                             72.277328            0.0            0.0          24              0.0 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_Quantity], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]                 NULL     PLAN_ROW                                                               -1          6400.1685

(18 rows affected)
