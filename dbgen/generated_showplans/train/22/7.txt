StmtText                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            StmtId      NodeId      Parent      PhysicalOp                     LogicalOp                      Argument                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              DefinedValues                                                                                                                  EstimateRows   EstimateIO     EstimateCPU    AvgRowSize  TotalSubtreeCost OutputList                                                                                                   Warnings Type                                                             Parallel EstimateExecutions
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------- ----------- ----------- ------------------------------ ------------------------------ --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------------------------------------------------------------------------------------------------------ -------------- -------------- -------------- ----------- ---------------- ------------------------------------------------------------------------------------------------------------ -------- ---------------------------------------------------------------- -------- ------------------

select
	cntrycode,
	count(*) as numcust,
	sum(c_acctbal) as totacctbal
from
	(
		select
			substring(c_phone, 1, 2) as cntrycode,
			c_acctbal
		from
			customer
		where
			substring(c_phone, 1, 2) in
				('12', '20', '23', '26', '18', '32', '28')
			and c_acctbal > (
				select
					avg(c_acctbal)
				from
					customer
				where
					c_acctbal > 0.00
					and substring(c_phone, 1, 2) in
						('12', '20', '23', '26', '18', '32', '28')
			)
			and not exists (
				select
					*
				from
					orders
				where
					o_custkey = c_custkey
			)
	) as custsale
group by
	cntrycode
order by
	cntrycode;              1           1           0 NULL                           NULL                           1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     NULL                                                                                                                                4892.1797           NULL           NULL        NULL        225.46005 NULL                                                                                                         NULL     SELECT                                                                  0               NULL
  |--Parallelism(Gather Streams, ORDER BY:([Expr1009] ASC))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1           2           1 Parallelism                    Gather Streams                 ORDER BY:([Expr1009] ASC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             NULL                                                                                                                                4892.1797            0.0   5.8374707E-2          34        225.46005 [Expr1009], [Expr1010], [Expr1011]                                                                           NULL     PLAN_ROW                                                               -1                1.0
       |--Sort(ORDER BY:([Expr1009] ASC))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     1           3           2 Sort                           Sort                           ORDER BY:([Expr1009] ASC)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             NULL                                                                                                                                4892.1797   9.3843846E-4    2.363442E-3          34        225.40169 [Expr1009], [Expr1010], [Expr1011]                                                                           NULL     PLAN_ROW                                                               -1                1.0
            |--Compute Scalar(DEFINE:([Expr1010]=CONVERT_IMPLICIT(int,[Expr1026],0)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1           4           3 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1010]=CONVERT_IMPLICIT(int,[Expr1026],0))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                [Expr1010]=CONVERT_IMPLICIT(int,[Expr1026],0)                                                                                       4892.1797            0.0            0.0          34        225.39838 [Expr1009], [Expr1010], [Expr1011]                                                                           NULL     PLAN_ROW                                                               -1                1.0
                 |--Hash Match(Aggregate, HASH:([Expr1009]), RESIDUAL:([Expr1009] = [Expr1009]) DEFINE:([Expr1026]=COUNT(*), [Expr1011]=SUM([TPCH].[dbo].[customer].[C_AcctBal])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1           5           4 Hash Match                     Aggregate                      HASH:([Expr1009]), RESIDUAL:([Expr1009] = [Expr1009])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 [Expr1026]=COUNT(*), [Expr1011]=SUM([TPCH].[dbo].[customer].[C_AcctBal])                                                            4892.1797            0.0   7.5959745E-3          34        225.39838 [Expr1009], [Expr1011], [Expr1026]                                                                           NULL     PLAN_ROW                                                               -1                1.0
                      |--Hash Match(Left Anti Semi Join, HASH:([TPCH].[dbo].[customer].[C_CustKey])=([TPCH].[dbo].[orders].[O_CustKey]), RESIDUAL:([TPCH].[dbo].[orders].[O_CustKey]=[TPCH].[dbo].[customer].[C_CustKey])DEFINE:([Opt_Bitmap1025]))                                                                                                                                                                                                                                                                                                                                                                                                                           1           6           5 Hash Match                     Left Anti Semi Join            HASH:([TPCH].[dbo].[customer].[C_CustKey])=([TPCH].[dbo].[orders].[O_CustKey]), RESIDUAL:([TPCH].[dbo].[orders].[O_CustKey]=[TPCH].[dbo].[customer].[C_CustKey])                                                                                                                                                                                                                                                                                                                                                                                                      [Opt_Bitmap1025]                                                                                                                    16463.178            0.0     0.18891142          22        225.39078 [TPCH].[dbo].[customer].[C_AcctBal], [Expr1009]                                                              NULL     PLAN_ROW                                                               -1                1.0
                           |--Nested Loops(Inner Join, WHERE:([TPCH].[dbo].[customer].[C_AcctBal]>[Expr1004]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1           7           6 Nested Loops                   Inner Join                     WHERE:([TPCH].[dbo].[customer].[C_AcctBal]>[Expr1004])                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                NULL                                                                                                                                37200.379            0.0   8.5659623E-2          26          52.4963 [TPCH].[dbo].[customer].[C_CustKey], [TPCH].[dbo].[customer].[C_AcctBal], [Expr1009]                         NULL     PLAN_ROW                                                               -1                1.0
                           |    |--Parallelism(Distribute Streams, Broadcast Partitioning)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1           9           7 Parallelism                    Distribute Streams             NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  NULL                                                                                                                                      1.0            0.0     0.02850277          24        26.297777 [Expr1004]                                                                                                   NULL     PLAN_ROW                                                               -1                1.0
                           |    |    |--Compute Scalar(DEFINE:([Expr1004]=CASE WHEN [globalagg1014]=(0) THEN NULL ELSE [globalagg1016]/CONVERT_IMPLICIT(decimal(19,0),[globalagg1014],0) END))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1          10           9 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1004]=CASE WHEN [globalagg1014]=(0) THEN NULL ELSE [globalagg1016]/CONVERT_IMPLICIT(decimal(19,0),[globalagg1014],0) END)                                                                                                                                                                                                                                                                                                                                                                                                                                [Expr1004]=CASE WHEN [globalagg1014]=(0) THEN NULL ELSE [globalagg1016]/CONVERT_IMPLICIT(decimal(19,0),[globalagg1014],0) END             1.0            0.0      0.0000001          24        26.269274 [Expr1004]                                                                                                   NULL     PLAN_ROW                                                                0                1.0
                           |    |         |--Stream Aggregate(DEFINE:([globalagg1014]=SUM([partialagg1013]), [globalagg1016]=SUM([partialagg1015])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1          11          10 Stream Aggregate               Aggregate                      NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  [globalagg1014]=SUM([partialagg1013]), [globalagg1016]=SUM([partialagg1015])                                                              1.0            0.0      0.0000029          32        26.269274 [globalagg1014], [globalagg1016]                                                                             NULL     PLAN_ROW                                                                0                1.0
                           |    |              |--Parallelism(Gather Streams)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 1          12          11 Parallelism                    Gather Streams                 NULL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  NULL                                                                                                                                      4.0            0.0   2.8503805E-2          32        26.269272 [partialagg1013], [partialagg1015]                                                                           NULL     PLAN_ROW                                                               -1                1.0
                           |    |                   |--Hash Match(Partial Aggregate, HASH:() DEFINE:([partialagg1013]=COUNT(*), [partialagg1015]=SUM([TPCH].[dbo].[customer].[C_AcctBal])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1          13          12 Hash Match                     Partial Aggregate              HASH:(), DEFINE:([partialagg1013]=COUNT(*), [partialagg1015]=SUM([TPCH].[dbo].[customer].[C_AcctBal]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                [partialagg1013]=COUNT(*), [partialagg1015]=SUM([TPCH].[dbo].[customer].[C_AcctBal])                                                      4.0            0.0   2.5571552E-3          32        26.240768 [partialagg1013], [partialagg1015]                                                                           NULL     PLAN_ROW                                                               -1                1.0
                           |    |                        |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[customer].[PK__customer__48695B71963F6D86]),  WHERE:([TPCH].[dbo].[customer].[C_AcctBal]>(0.00) AND (substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='28' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='32' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='18' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='26' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='23' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='20' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='12')))                        1          15          13 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[customer].[PK__customer__48695B71963F6D86]),  WHERE:([TPCH].[dbo].[customer].[C_AcctBal]>(0.00) AND (substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='28' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='32' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='18' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='26' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='23' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='20' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='12'))  [TPCH].[dbo].[customer].[C_AcctBal]                                                                                                 78184.891      24.779421     0.41253924          52        25.191961 [TPCH].[dbo].[customer].[C_AcctBal]                                                                          NULL     PLAN_ROW                                                               -1                1.0
                           |    |--Compute Scalar(DEFINE:([Expr1009]=substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1          16           7 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1009]=substring([TPCH].[dbo].[customer].[C_Phone],(1),(2)))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              [Expr1009]=substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))                                                                      81970.93            0.0   3.7499999E-3          26        25.195711 [TPCH].[dbo].[customer].[C_CustKey], [TPCH].[dbo].[customer].[C_AcctBal], [Expr1009]                         NULL     PLAN_ROW                                                               -1                1.0
                           |         |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[customer].[PK__customer__48695B71963F6D86]),  WHERE:(substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='28' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='32' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='18' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='26' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='23' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='20' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='12'))                                                                                             1          17          16 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[customer].[PK__customer__48695B71963F6D86]),  WHERE:(substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='28' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='32' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='18' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='26' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='23' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='20' OR substring([TPCH].[dbo].[customer].[C_Phone],(1),(2))='12')                                                   [TPCH].[dbo].[customer].[C_CustKey], [TPCH].[dbo].[customer].[C_Phone], [TPCH].[dbo].[customer].[C_AcctBal]                          81970.93      24.779421     0.41253924          39        25.191961 [TPCH].[dbo].[customer].[C_CustKey], [TPCH].[dbo].[customer].[C_Phone], [TPCH].[dbo].[customer].[C_AcctBal]  NULL     PLAN_ROW                                                               -1                1.0
                           |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[orders].[PK__orders__0F8A125214F3A7C2]),  WHERE:(PROBE([Opt_Bitmap1025],[TPCH].[dbo].[orders].[O_CustKey])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         1          19           6 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[orders].[PK__orders__0F8A125214F3A7C2]),  WHERE:(PROBE([Opt_Bitmap1025],[TPCH].[dbo].[orders].[O_CustKey]))                                                                                                                                                                                                                                                                                                                                                                                                                                     [TPCH].[dbo].[orders].[O_CustKey]                                                                                                   1500000.0      168.57867      4.1212893          11        172.69997 [TPCH].[dbo].[orders].[O_CustKey]                                                                            NULL     PLAN_ROW                                                               -1                1.0

(16 rows affected)
