StmtText                                                                                                                                                                                                                                                                                                                                                          StmtId      NodeId      Parent      PhysicalOp                     LogicalOp                      Argument                                                                                                                                                                                                        DefinedValues                                                                                                                                                                                                                                                                                                                                                                                EstimateRows   EstimateIO     EstimateCPU    AvgRowSize  TotalSubtreeCost OutputList                                                                                                                        Warnings Type                                                             Parallel EstimateExecutions
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------- ----------- ----------- ------------------------------ ------------------------------ --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------- -------------- -------------- ----------- ---------------- --------------------------------------------------------------------------------------------------------------------------------- -------- ---------------------------------------------------------------- -------- ------------------

select
	100.00 * sum(case
		when p_type like 'PROMO%'
			then l_extendedprice * (1 - l_discount)
		else 0
	end) / sum(l_extendedprice * (1 - l_discount)) as promo_revenue
from
	lineitem,
	part
where
	l_partkey = p_partkey
	and l_shipdate >= cast('1993-03-01' as datetime)
	and l_shipdate < dateadd(mm, 1, cast('1993-03-01' as datetime))              1           1           0 NULL                           NULL                           1                                                                                                                                                                                                               NULL                                                                                                                                                                                                                                                                                                                                                                                                    1.0           NULL           NULL        NULL        824.49072 NULL                                                                                                                              NULL     SELECT                                                                  0               NULL
  |--Parallelism(Gather Streams)                                                                                                                                                                                                                                                                                                                                            1           2           1 Parallelism                    Gather Streams                 NULL                                                                                                                                                                                                            NULL                                                                                                                                                                                                                                                                                                                                                                                                    1.0            0.0     0.02850277          24        824.49072 [Expr1006]                                                                                                                        NULL     PLAN_ROW                                                               -1                1.0
       |--Compute Scalar(DEFINE:([Expr1006]=(100.00)*[Expr1004]/[Expr1005]))                                                                                                                                                                                                                                                                                                1           3           2 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1006]=(100.00)*[Expr1004]/[Expr1005])                                                                                                                                                              [Expr1006]=(100.00)*[Expr1004]/[Expr1005]                                                                                                                                                                                                                                                                                                                                                               1.0            0.0         2.5E-9          24        824.46222 [Expr1006]                                                                                                                        NULL     PLAN_ROW                                                               -1                1.0
            |--Compute Scalar(DEFINE:([Expr1004]=CASE WHEN [Expr1022]=(0) THEN NULL ELSE [Expr1023] END, [Expr1005]=CASE WHEN [Expr1024]=(0) THEN NULL ELSE [Expr1025] END))                                                                                                                                                                                                1           4           3 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1004]=CASE WHEN [Expr1022]=(0) THEN NULL ELSE [Expr1023] END, [Expr1005]=CASE WHEN [Expr1024]=(0) THEN NULL ELSE [Expr1025] END)                                                                   [Expr1004]=CASE WHEN [Expr1022]=(0) THEN NULL ELSE [Expr1023] END, [Expr1005]=CASE WHEN [Expr1024]=(0) THEN NULL ELSE [Expr1025] END                                                                                                                                                                                                                                                                    1.0            0.0            0.0          41        824.46222 [Expr1004], [Expr1005]                                                                                                            NULL     PLAN_ROW                                                               -1                1.0
                 |--Hash Match(Aggregate, HASH:() DEFINE:([Expr1022]=COUNT_BIG([Expr1021]), [Expr1023]=SUM([Expr1021]), [Expr1024]=COUNT_BIG([Expr1007]), [Expr1025]=SUM([Expr1007])))                                                                                                                                                                                      1           5           4 Hash Match                     Aggregate                      HASH:()                                                                                                                                                                                                         [Expr1022]=COUNT_BIG([Expr1021]), [Expr1023]=SUM([Expr1021]), [Expr1024]=COUNT_BIG([Expr1007]), [Expr1025]=SUM([Expr1007])                                                                                                                                                                                                                                                                              1.0            0.0    9.014003E-3          41        824.46222 [Expr1022], [Expr1023], [Expr1024], [Expr1025]                                                                                    NULL     PLAN_ROW                                                               -1                1.0
                      |--Compute Scalar(DEFINE:([Expr1021]=CASE WHEN [TPCH].[dbo].[part].[P_Type] like 'PROMO%' THEN [TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount]) ELSE (0.0000) END))                                                                                                                                              1           6           5 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1021]=CASE WHEN [TPCH].[dbo].[part].[P_Type] like 'PROMO%' THEN [TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount]) ELSE (0.0000) END)                           [Expr1021]=CASE WHEN [TPCH].[dbo].[part].[P_Type] like 'PROMO%' THEN [TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount]) ELSE (0.0000) END                                                                                                                                                                                                                      723892.62            0.0   1.8097316E-3          33        824.45319 [Expr1007], [Expr1021]                                                                                                            NULL     PLAN_ROW                                                               -1                1.0
                           |--Adaptive Join                                                                                                                                                                                                                                                                                                                                 1           7           6 Adaptive Join                  Inner Join                     NULL                                                                                                                                                                                                            [TPCH].[dbo].[lineitem].[L_ExtendedPrice] = ([TPCH].[dbo].[lineitem].[L_ExtendedPrice], [TPCH].[dbo].[lineitem].[L_ExtendedPrice]), [TPCH].[dbo].[lineitem].[L_Discount] = ([TPCH].[dbo].[lineitem].[L_Discount], [TPCH].[dbo].[lineitem].[L_Discount]), [TPCH].[dbo].[part].[P_Type] = ([TPCH].[dbo].[part].[P_Type], [TPCH].[dbo].[part].[P_Type]), [Expr1007] = ([Expr1007], [Expr1007])       723892.62            0.0   3.6194632E-3          74        824.45502 [TPCH].[dbo].[lineitem].[L_ExtendedPrice], [TPCH].[dbo].[lineitem].[L_Discount], [TPCH].[dbo].[part].[P_Type], [Expr1007]         NULL     PLAN_ROW                                                               -1                1.0
                                |--Compute Scalar(DEFINE:([Expr1007]=[TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount])))                                                                                                                                                                                                                1           9           7 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1007]=[TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount]))                                                                                                       [Expr1007]=[TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount])                                                                                                                                                                                                                                                                                                  723892.62            0.0   1.8097316E-3          42        797.99805 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_ExtendedPrice], [TPCH].[dbo].[lineitem].[L_Discount], [Expr1007]  NULL     PLAN_ROW                                                               -1                1.0
                                |    |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[lineitem].[PK__lineitem__2B16504E85092D9C]),  WHERE:([TPCH].[dbo].[lineitem].[L_ShipDate]>='1993-03-01 00:00:00.000' AND [TPCH].[dbo].[lineitem].[L_ShipDate]<'1993-04-01 00:00:00.000'))                                                                                                1          10           9 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[lineitem].[PK__lineitem__2B16504E85092D9C]),  WHERE:([TPCH].[dbo].[lineitem].[L_ShipDate]>='1993-03-01 00:00:00.000' AND [TPCH].[dbo].[lineitem].[L_ShipDate]<'1993-04-01 00:00:00.000')  [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_ExtendedPrice], [TPCH].[dbo].[lineitem].[L_Discount]                                                                                                                                                                                                                                                                              723892.62       768.3031      16.496204          37        784.79932 [TPCH].[dbo].[lineitem].[L_PartKey], [TPCH].[dbo].[lineitem].[L_ExtendedPrice], [TPCH].[dbo].[lineitem].[L_Discount]              NULL     PLAN_ROW                                                               -1                1.0
                                |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[part].[PK__part__418EE012D7A9C198]),  WHERE:(PROBE([Opt_Bitmap1019],[TPCH].[dbo].[part].[P_PartKey])))                                                                                                                                                                                        1          12           9 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[part].[PK__part__418EE012D7A9C198]),  WHERE:(PROBE([Opt_Bitmap1019],[TPCH].[dbo].[part].[P_PartKey]))                                                                                     [TPCH].[dbo].[part].[P_PartKey], [TPCH].[dbo].[part].[P_Type]                                                                                                                                                                                                                                                                                                                                      200000.0      25.372755     0.54953927          47        25.922295 [TPCH].[dbo].[part].[P_PartKey], [TPCH].[dbo].[part].[P_Type]                                                                     NULL     PLAN_ROW                                                               -1                1.0
                                |--Clustered Index Seek(OBJECT:([TPCH].[dbo].[part].[PK__part__418EE012D7A9C198]), SEEK:([TPCH].[dbo].[part].[P_PartKey]=[TPCH].[dbo].[lineitem].[L_PartKey]) ORDERED FORWARD)                                                                                                                                                              1          16           7 Clustered Index Seek           Clustered Index Seek           OBJECT:([TPCH].[dbo].[part].[PK__part__418EE012D7A9C198]), SEEK:([TPCH].[dbo].[part].[P_PartKey]=[TPCH].[dbo].[lineitem].[L_PartKey]) ORDERED FORWARD                                                           [TPCH].[dbo].[part].[P_Type]                                                                                                                                                                                                                                                                                                                                                                            1.0       0.003125      0.0001581          43        221.47803 [TPCH].[dbo].[part].[P_Type]                                                                                                      NULL     PLAN_ROW                                                               -1          723892.62

(11 rows affected)
