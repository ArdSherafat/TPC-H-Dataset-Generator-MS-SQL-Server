StmtText                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   StmtId      NodeId      Parent      PhysicalOp                     LogicalOp                      Argument                                                                                                                                                                                                                                                                                                                                                                                                                              DefinedValues                                                                                                                                                                                     EstimateRows   EstimateIO     EstimateCPU    AvgRowSize  TotalSubtreeCost OutputList                                                                                                                                                                                        Warnings Type                                                             Parallel EstimateExecutions
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ----------- ----------- ----------- ------------------------------ ------------------------------ ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------------- -------------- -------------- ----------- ---------------- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -------- ---------------------------------------------------------------- -------- ------------------

select
	supp_nation,
	cust_nation,
	l_year,
	sum(volume) as revenue
from
	(
		select
			n1.n_name as supp_nation,
			n2.n_name as cust_nation,
			datepart(yy, l_shipdate) as l_year,
			l_extendedprice * (1 - l_discount) as volume
		from
			supplier,
			lineitem,
			orders,
			customer,
			nation n1,
			nation n2
		where
			s_suppkey = l_suppkey
			and o_orderkey = l_orderkey
			and c_custkey = o_custkey
			and s_nationkey = n1.n_nationkey
			and c_nationkey = n2.n_nationkey
			and (
				(n1.n_name = 'GERMANY' and n2.n_name = 'BRAZIL')
				or (n1.n_name = 'BRAZIL' and n2.n_name = 'GERMANY')
			)
			and l_shipdate between cast('1995-01-01' as datetime) and cast('1996-12-31' as datetime)
	) as shipping
group by
	supp_nation,
	cust_nation,
	l_year
order by
	supp_nation,
	cust_nation,
	l_year;              1           1           0 NULL                           NULL                           1                                                                                                                                                                                                                                                                                                                                                                                                                                     NULL                                                                                                                                                                                                         2.0           NULL           NULL        NULL        998.03607 NULL                                                                                                                                                                                              NULL     SELECT                                                                  0               NULL
  |--Compute Scalar(DEFINE:([Expr1012]=CASE WHEN [globalagg1027]=(0) THEN NULL ELSE [globalagg1029] END))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1           3           1 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1012]=CASE WHEN [globalagg1027]=(0) THEN NULL ELSE [globalagg1029] END)                                                                                                                                                                                                                                                                                                                                                  [Expr1012]=CASE WHEN [globalagg1027]=(0) THEN NULL ELSE [globalagg1029] END                                                                                                                                  2.0            0.0      0.0000002          73        998.03607 [n1].[N_Name], [n2].[N_Name], [Expr1010], [Expr1012]                                                                                                                                              NULL     PLAN_ROW                                                                0                1.0
       |--Stream Aggregate(GROUP BY:([n1].[N_Name], [n2].[N_Name], [Expr1010]) DEFINE:([globalagg1027]=SUM([partialagg1026]), [globalagg1029]=SUM([partialagg1028])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                1           4           3 Stream Aggregate               Aggregate                      GROUP BY:([n1].[N_Name], [n2].[N_Name], [Expr1010])                                                                                                                                                                                                                                                                                                                                                                                   [globalagg1027]=SUM([partialagg1026]), [globalagg1029]=SUM([partialagg1028])                                                                                                                                 2.0            0.0   5.8000001E-6          81        998.03607 [n1].[N_Name], [n2].[N_Name], [Expr1010], [globalagg1027], [globalagg1029]                                                                                                                        NULL     PLAN_ROW                                                                0                1.0
            |--Parallelism(Gather Streams, ORDER BY:([n1].[N_Name] ASC, [n2].[N_Name] ASC, [Expr1010] ASC))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          1           5           4 Parallelism                    Gather Streams                 ORDER BY:([n1].[N_Name] ASC, [n2].[N_Name] ASC, [Expr1010] ASC)                                                                                                                                                                                                                                                                                                                                                                       NULL                                                                                                                                                                                                         8.0            0.0   2.8557271E-2          81        998.03607 [n1].[N_Name], [n2].[N_Name], [Expr1010], [partialagg1026], [partialagg1028]                                                                                                                      NULL     PLAN_ROW                                                               -1                1.0
                 |--Sort(ORDER BY:([n1].[N_Name] ASC, [n2].[N_Name] ASC, [Expr1010] ASC))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1           6           5 Sort                           Sort                           ORDER BY:([n1].[N_Name] ASC, [n2].[N_Name] ASC, [Expr1010] ASC)                                                                                                                                                                                                                                                                                                                                                                       NULL                                                                                                                                                                                                         8.0   9.3843846E-4   2.5956249E-5          81        998.00751 [n1].[N_Name], [n2].[N_Name], [Expr1010], [partialagg1026], [partialagg1028]                                                                                                                      NULL     PLAN_ROW                                                               -1                1.0
                      |--Hash Match(Inner Join, HASH:([n2].[N_NationKey])=([TPCH].[dbo].[customer].[C_NationKey]), RESIDUAL:([TPCH].[dbo].[customer].[C_NationKey]=[TPCH].[dbo].[nation].[N_NationKey] as [n2].[N_NationKey] AND ([TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='GERMANY' AND [TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='BRAZIL' OR [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='BRAZIL' AND [TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='GERMANY'))DEFINE:([Opt_Bitmap1127]))                                                                                                                                                                                                                                                                                                                                                                       1           7           6 Hash Match                     Inner Join                     HASH:([n2].[N_NationKey])=([TPCH].[dbo].[customer].[C_NationKey]), RESIDUAL:([TPCH].[dbo].[customer].[C_NationKey]=[TPCH].[dbo].[nation].[N_NationKey] as [n2].[N_NationKey] AND ([TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='GERMANY' AND [TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='BRAZIL' OR [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='BRAZIL' AND [TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='GERMANY'))  [Opt_Bitmap1127]                                                                                                                                                                                             8.0            0.0   1.7779961E-3          81        998.00653 [n1].[N_Name], [n2].[N_Name], [Expr1010], [partialagg1026], [partialagg1028]                                                                                                                      NULL     PLAN_ROW                                                               -1                1.0
                           |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[nation].[PK__nation__BD3779521509254A] AS [n2]),  WHERE:([TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='BRAZIL' OR [TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='GERMANY'))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1           8           7 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[nation].[PK__nation__BD3779521509254A] AS [n2]),  WHERE:([TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='BRAZIL' OR [TPCH].[dbo].[nation].[N_Name] as [n2].[N_Name]='GERMANY')                                                                                                                                                                                                                                 [n2].[N_NationKey], [n2].[N_Name]                                                                                                                                                                            2.0       0.003125   4.6124998E-5          47      3.171125E-3 [n2].[N_NationKey], [n2].[N_Name]                                                                                                                                                                 NULL     PLAN_ROW                                                               -1                1.0
                           |--Hash Match(Aggregate, HASH:([TPCH].[dbo].[customer].[C_NationKey], [n1].[N_Name], [Expr1010]), RESIDUAL:([TPCH].[dbo].[customer].[C_NationKey] = [TPCH].[dbo].[customer].[C_NationKey] AND [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name] = [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name] AND [Expr1010] = [Expr1010]) DEFINE:([partialagg1026]=COUNT_BIG([Expr1013]), [partialagg1028]=SUM([Expr1013])))                                                                                                                                                                                                                                                                                                                                                                                                                                           1           9           7 Hash Match                     Aggregate                      HASH:([TPCH].[dbo].[customer].[C_NationKey], [n1].[N_Name], [Expr1010]), RESIDUAL:([TPCH].[dbo].[customer].[C_NationKey] = [TPCH].[dbo].[customer].[C_NationKey] AND [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name] = [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name] AND [Expr1010] = [Expr1010])                                                                                                                                   [partialagg1026]=COUNT_BIG([Expr1013]), [partialagg1028]=SUM([Expr1013])                                                                                                                                    10.0            0.0     0.02772258          51        998.00159 [TPCH].[dbo].[customer].[C_NationKey], [n1].[N_Name], [Expr1010], [partialagg1026], [partialagg1028]                                                                                              NULL     PLAN_ROW                                                               -1                1.0
                                |--Hash Match(Inner Join, HASH:([TPCH].[dbo].[customer].[C_CustKey])=([TPCH].[dbo].[orders].[O_CustKey]), RESIDUAL:([TPCH].[dbo].[customer].[C_CustKey]=[TPCH].[dbo].[orders].[O_CustKey])DEFINE:([Opt_Bitmap1128]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 1          10           9 Hash Match                     Inner Join                     HASH:([TPCH].[dbo].[customer].[C_CustKey])=([TPCH].[dbo].[orders].[O_CustKey]), RESIDUAL:([TPCH].[dbo].[customer].[C_CustKey]=[TPCH].[dbo].[orders].[O_CustKey])                                                                                                                                                                                                                                                                      [Opt_Bitmap1128]                                                                                                                                                                                       145955.28            0.0   7.3261306E-2          39        997.97388 [TPCH].[dbo].[customer].[C_NationKey], [n1].[N_Name], [Expr1010], [Expr1013]                                                                                                                      NULL     PLAN_ROW                                                               -1                1.0
                                     |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[customer].[PK__customer__48695B71963F6D86]),  WHERE:(PROBE([Opt_Bitmap1127],[TPCH].[dbo].[customer].[C_NationKey])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              1          12          10 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[customer].[PK__customer__48695B71963F6D86]),  WHERE:(PROBE([Opt_Bitmap1127],[TPCH].[dbo].[customer].[C_NationKey]))                                                                                                                                                                                                                                                                                             [TPCH].[dbo].[customer].[C_CustKey], [TPCH].[dbo].[customer].[C_NationKey]                                                                                                                              150000.0      24.779421     0.41216424          15        25.191586 [TPCH].[dbo].[customer].[C_CustKey], [TPCH].[dbo].[customer].[C_NationKey]                                                                                                                        NULL     PLAN_ROW                                                               -1                1.0
                                     |--Hash Match(Inner Join, HASH:([n1].[N_NationKey])=([TPCH].[dbo].[supplier].[S_NationKey]), RESIDUAL:([TPCH].[dbo].[supplier].[S_NationKey]=[TPCH].[dbo].[nation].[N_NationKey] as [n1].[N_NationKey])DEFINE:([Opt_Bitmap1129]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               1          13          10 Hash Match                     Inner Join                     HASH:([n1].[N_NationKey])=([TPCH].[dbo].[supplier].[S_NationKey]), RESIDUAL:([TPCH].[dbo].[supplier].[S_NationKey]=[TPCH].[dbo].[nation].[N_NationKey] as [n1].[N_NationKey])                                                                                                                                                                                                                                                         [Opt_Bitmap1129]                                                                                                                                                                                       145955.28            0.0   3.3823244E-2          39        972.70898 [TPCH].[dbo].[orders].[O_CustKey], [n1].[N_Name], [Expr1010], [Expr1013]                                                                                                                          NULL     PLAN_ROW                                                               -1                1.0
                                          |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[nation].[PK__nation__BD3779521509254A] AS [n1]),  WHERE:([TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='BRAZIL' OR [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='GERMANY'))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             1          14          13 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[nation].[PK__nation__BD3779521509254A] AS [n1]),  WHERE:([TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='BRAZIL' OR [TPCH].[dbo].[nation].[N_Name] as [n1].[N_Name]='GERMANY')                                                                                                                                                                                                                                 [n1].[N_NationKey], [n1].[N_Name]                                                                                                                                                                            2.0       0.003125   4.6124998E-5          22      3.171125E-3 [n1].[N_NationKey], [n1].[N_Name]                                                                                                                                                                 NULL     PLAN_ROW                                                               -1                1.0
                                          |--Hash Match(Inner Join, HASH:([TPCH].[dbo].[supplier].[S_SuppKey])=([TPCH].[dbo].[lineitem].[L_SuppKey]), RESIDUAL:([TPCH].[dbo].[supplier].[S_SuppKey]=[TPCH].[dbo].[lineitem].[L_SuppKey])DEFINE:([Opt_Bitmap1131]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   1          15          13 Hash Match                     Inner Join                     HASH:([TPCH].[dbo].[supplier].[S_SuppKey])=([TPCH].[dbo].[lineitem].[L_SuppKey]), RESIDUAL:([TPCH].[dbo].[supplier].[S_SuppKey]=[TPCH].[dbo].[lineitem].[L_SuppKey])                                                                                                                                                                                                                                                                  [Opt_Bitmap1131]                                                                                                                                                                                       182442.22            0.0   3.9524402E-2          32          972.672 [TPCH].[dbo].[supplier].[S_NationKey], [TPCH].[dbo].[orders].[O_CustKey], [Expr1010], [Expr1013]                                                                                                  NULL     PLAN_ROW                                                               -1                1.0
                                               |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[supplier].[PK__supplier__C9D8C8B7D7E219CD]),  WHERE:(PROBE([Opt_Bitmap1129],[TPCH].[dbo].[supplier].[S_NationKey])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    1          17          15 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[supplier].[PK__supplier__C9D8C8B7D7E219CD]),  WHERE:(PROBE([Opt_Bitmap1129],[TPCH].[dbo].[supplier].[S_NationKey]))                                                                                                                                                                                                                                                                                             [TPCH].[dbo].[supplier].[S_SuppKey], [TPCH].[dbo].[supplier].[S_NationKey]                                                                                                                               10000.0      1.4505324   2.7514249E-2          15        1.4780467 [TPCH].[dbo].[supplier].[S_SuppKey], [TPCH].[dbo].[supplier].[S_NationKey]                                                                                                                        NULL     PLAN_ROW                                                               -1                1.0
                                               |--Hash Match(Inner Join, HASH:([TPCH].[dbo].[orders].[O_OrderKey])=([TPCH].[dbo].[lineitem].[L_OrderKey])DEFINE:([Opt_Bitmap1084]))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  1          18          15 Hash Match                     Inner Join                     HASH:([TPCH].[dbo].[orders].[O_OrderKey])=([TPCH].[dbo].[lineitem].[L_OrderKey])                                                                                                                                                                                                                                                                                                                                                      [Opt_Bitmap1084]                                                                                                                                                                                       182442.22            0.0      0.4727419          32        971.15442 [TPCH].[dbo].[lineitem].[L_SuppKey], [TPCH].[dbo].[orders].[O_CustKey], [Expr1010], [Expr1013]                                                                                                    NULL     PLAN_ROW                                                               -1                1.0
                                                    |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[orders].[PK__orders__0F8A125214F3A7C2]),  WHERE:(PROBE([Opt_Bitmap1128],[TPCH].[dbo].[orders].[O_CustKey])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       1          20          18 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[orders].[PK__orders__0F8A125214F3A7C2]),  WHERE:(PROBE([Opt_Bitmap1128],[TPCH].[dbo].[orders].[O_CustKey]))                                                                                                                                                                                                                                                                                                     [TPCH].[dbo].[orders].[O_OrderKey], [TPCH].[dbo].[orders].[O_CustKey]                                                                                                                                  1500000.0      168.57867      4.1212893          15        172.69997 [TPCH].[dbo].[orders].[O_OrderKey], [TPCH].[dbo].[orders].[O_CustKey]                                                                                                                             NULL     PLAN_ROW                                                               -1                1.0
                                                    |--Compute Scalar(DEFINE:([Expr1010]=datepart(year,[TPCH].[dbo].[lineitem].[L_ShipDate]), [Expr1013]=[TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount])))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     1          21          18 Compute Scalar                 Compute Scalar                 DEFINE:([Expr1010]=datepart(year,[TPCH].[dbo].[lineitem].[L_ShipDate]), [Expr1013]=[TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount]))                                                                                                                                                                                                                                                             [Expr1010]=datepart(year,[TPCH].[dbo].[lineitem].[L_ShipDate]), [Expr1013]=[TPCH].[dbo].[lineitem].[L_ExtendedPrice]*((1.)-[TPCH].[dbo].[lineitem].[L_Discount])                                       182442.23            0.0    4.561056E-4          32        797.98169 [TPCH].[dbo].[lineitem].[L_OrderKey], [TPCH].[dbo].[lineitem].[L_SuppKey], [Expr1010], [Expr1013]                                                                                                 NULL     PLAN_ROW                                                               -1                1.0
                                                         |--Clustered Index Scan(OBJECT:([TPCH].[dbo].[lineitem].[PK__lineitem__2B16504E85092D9C]),  WHERE:([TPCH].[dbo].[lineitem].[L_ShipDate]>='1995-01-01 00:00:00.000' AND [TPCH].[dbo].[lineitem].[L_ShipDate]<='1996-12-31 00:00:00.000' AND PROBE([Opt_Bitmap1131],[TPCH].[dbo].[lineitem].[L_SuppKey]) AND PROBE([Opt_Bitmap1084],[TPCH].[dbo].[lineitem].[L_OrderKey])))                                                                                                                                                                                                                                                                                                                                                                                                                                                   1          23          21 Clustered Index Scan           Clustered Index Scan           OBJECT:([TPCH].[dbo].[lineitem].[PK__lineitem__2B16504E85092D9C]),  WHERE:([TPCH].[dbo].[lineitem].[L_ShipDate]>='1995-01-01 00:00:00.000' AND [TPCH].[dbo].[lineitem].[L_ShipDate]<='1996-12-31 00:00:00.000' AND PROBE([Opt_Bitmap1131],[TPCH].[dbo].[lineitem].[L_SuppKey]) AND PROBE([Opt_Bitmap1084],[TPCH].[dbo].[lineitem].[L_OrderKey]))                                                                                      [TPCH].[dbo].[lineitem].[L_OrderKey], [TPCH].[dbo].[lineitem].[L_SuppKey], [TPCH].[dbo].[lineitem].[L_ExtendedPrice], [TPCH].[dbo].[lineitem].[L_Discount], [TPCH].[dbo].[lineitem].[L_ShipDate]       182442.23       768.3031      16.481207          41         784.7843 [TPCH].[dbo].[lineitem].[L_OrderKey], [TPCH].[dbo].[lineitem].[L_SuppKey], [TPCH].[dbo].[lineitem].[L_ExtendedPrice], [TPCH].[dbo].[lineitem].[L_Discount], [TPCH].[dbo].[lineitem].[L_ShipDate]  NULL     PLAN_ROW                                                               -1                1.0

(18 rows affected)
